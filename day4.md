# 🗡️ Day4: Linux Quest - 守護の印章（パーミッション）

---

## 📖 ストーリー：秘密の宝箱と守護の呪文

冒険も4日目。あなたは書物を読む技術を身につけた。  
しかし今日、重要な発見をする。この世界には「見えない鍵」がかかったファイルがあることを。

賢者（Claude）が厳格な表情で現れる：

> 「勇者よ、今日は重要な話だ。この世界では、すべてのファイルとディレクトリに  
> 『守護の印章』が刻まれている。誰が読めるか、誰が書けるか、誰が実行できるか...  
> これを理解せずして、この世界の真の主となることはできない。」

---

## 🎯 今日のクエスト目標
**「ファイルの権限システムを理解し、chmod で権限を自在に操る」**

---

## 🧙‍♂️ 基礎知識：権限という概念

### なぜ権限が必要なのか？
- **セキュリティ**：他人に見られてはいけないファイルを保護
- **安全性**：重要なシステムファイルの誤った変更を防止
- **プライバシー**：個人ファイルの管理
- **システム安定性**：権限のないユーザーがシステムを破壊することを防ぐ

### 3つの権限種類
1. **読み取り（Read, r）**：ファイルの内容を見ることができる
2. **書き込み（Write, w）**：ファイルを変更・削除できる
3. **実行（Execute, x）**：ファイルを実行できる（プログラムとして）

### 3つの対象グループ
1. **所有者（Owner, u）**：ファイルを作った人
2. **グループ（Group, g）**：所有者と同じグループのメンバー
3. **その他（Others, o）**：それ以外の全ての人

---

## ⚔️ 実践クエスト

### Step 1: 冒険拠点の状況確認

```bash
cd my_linux_adventure
ls -l
```

**詳細な権限表示の読み方：**
```
-rw-r--r-- 1 user user  123 Jul 28 10:30 adventure_log.txt
drwxr-xr-x 2 user user 4096 Jul 28 09:15 some_directory
```

**解読方法：**
- 1文字目：ファイル種類（`-`=ファイル、`d`=ディレクトリ）
- 2-4文字目：所有者の権限（rwx）
- 5-7文字目：グループの権限（rwx）
- 8-10文字目：その他の権限（rwx）

### Step 2: 秘密ファイルを作成

```bash
echo "これは秘密の情報です" > secret.txt
ls -l secret.txt
```

### Step 3: 権限を読み解く

現在の権限を分析してみよう：
```
-rw-r--r-- 1 user user 15 Jul 28 12:00 secret.txt
```

これは：
- **所有者**：読み・書き可能（rw-）
- **グループ**：読み取りのみ（r--）
- **その他**：読み取りのみ（r--）

### Step 4: 権限を変更してみる（数字表記）

```bash
chmod 600 secret.txt
ls -l secret.txt
```

**数字の意味：**
- **4**：読み取り（r）
- **2**：書き込み（w）
- **1**：実行（x）

**600** = **6**（所有者：4+2=読み書き）+ **0**（グループ：なし）+ **0**（その他：なし）

### Step 5: よく使う権限パターン

```bash
# 所有者のみ読み書き
chmod 600 secret.txt

# 所有者は読み書き、他は読み取りのみ
chmod 644 secret.txt

# 全員が読み書き可能（危険！）
chmod 666 secret.txt

# 実行可能なスクリプト
chmod 755 script.txt
```

### Step 6: 文字表記での権限変更

```bash
# 所有者に実行権限を追加
chmod u+x secret.txt

# グループから書き込み権限を削除
chmod g-w secret.txt

# その他に読み取り権限を追加
chmod o+r secret.txt

# 全員に実行権限を付与
chmod a+x secret.txt
```

### Step 7: 実行可能なスクリプトを作成

```bash
echo '#!/bin/bash' > my_first_script.sh
echo 'echo "Hello from my script!"' >> my_first_script.sh
chmod 755 my_first_script.sh
ls -l my_first_script.sh
```

### Step 8: スクリプトを実行

```bash
./my_first_script.sh
```

**`./`** = 現在のディレクトリ内のファイルを実行

### Step 9: ディレクトリの権限

```bash
mkdir test_dir
chmod 755 test_dir    # 通常のディレクトリ権限
chmod 700 test_dir    # 所有者のみアクセス可能
ls -ld test_dir
```

**`ls -ld`** = ディレクトリ自体の情報を表示

---

## 💡 今日学んだ魔法の言葉（コマンド）

| コマンド | 意味 | 効果 |
|----------|------|------|
| `ls -l` | 詳細表示 | ファイルの権限情報を表示 |
| `chmod` | 権限変更 | ファイル・ディレクトリの権限を変更 |
| `chmod 644` | 数字権限 | 数字で権限を指定 |
| `chmod u+x` | 文字権限 | 文字で権限を追加・削除 |
| `ls -ld` | ディレクトリ情報 | ディレクトリ自体の権限を表示 |

---

## 🔢 権限の数字表記 完全ガイド

### 基本の数字
| 権限 | 数字 | 意味 |
|------|------|------|
| --- | 0 | 権限なし |
| --x | 1 | 実行のみ |
| -w- | 2 | 書き込みのみ |
| -wx | 3 | 書き込み+実行 |
| r-- | 4 | 読み取りのみ |
| r-x | 5 | 読み取り+実行 |
| rw- | 6 | 読み取り+書き込み |
| rwx | 7 | 全権限 |

### よく使うパターン
| 権限 | 数字 | 用途 |
|------|------|------|
| rw------- | 600 | 個人の秘密ファイル |
| rw-r--r-- | 644 | 一般的なファイル |
| rwxr-xr-x | 755 | 実行可能ファイル |
| rwx------ | 700 | 個人ディレクトリ |

---

## 🔍 権限トラブルシューティング

### よくあるエラーと対処法

**「Permission denied」エラー**
```bash
# 権限不足の場合
chmod +r filename    # 読み取り権限追加
chmod +w filename    # 書き込み権限追加
chmod +x filename    # 実行権限追加
```

**スクリプトが実行できない**
```bash
chmod 755 script.sh
./script.sh
```

---

## 🏆 今日の成果確認

以下をすべて実行できたらDay4クリア！

- [ ] `ls -l` で権限表示を読み解いた
- [ ] `chmod` で数字表記での権限変更を行った
- [ ] `chmod` で文字表記での権限変更を行った
- [ ] 実行可能なスクリプトファイルを作成した
- [ ] `./` でスクリプトを実行した
- [ ] ディレクトリの権限について理解した

---

## 🔮 賢者からの一言

> 「素晴らしい！君は今日、この世界の最も重要な概念の一つを習得した。  
> 権限は単なる技術的制約ではない。それは責任であり、信頼の証でもある。  
> 適切な権限設定こそが、安全で信頼できるシステムを築く基盤なのだ。  
> 明日は、君が作ったスクリプトをさらに発展させよう。」

---

## 📚 明日への予告

**Day5 テーマ：「魔法の巻物 - 実行ファイルとスクリプト」**

- シェルスクリプトの基本構造
- 変数の使い方
- 条件分岐と繰り返し
- 便利なスクリプトの作成
- 実行の様々な方法

---

## 🎯 実践チャレンジ

余裕があれば挑戦してみよう：

1. 自分だけが読めるファイルを作成（chmod 600）
2. 全員が実行できるスクリプトを作成（chmod 755）
3. システムの重要ファイルの権限を観察（/etc/passwd など）
4. ディレクトリの権限を変更して動作の違いを確認

---

### 💪 モチベーション・メッセージ

**「権限を理解することは、システム管理者の第一歩。  
今日君が学んだ知識は、セキュリティエンジニアやDevOpsエンジニアが  
毎日使っている実践的なスキルだ。権限を制する者が、システムを制する。」**

**Day4 完了！明日はいよいよスクリプト作成の世界へ。** 🎯